define([],function(){return openbiz.MiddleWareRouter.extend({isRendered:!1,app:"mainapp",middlewares:{"*any":"renderLayout","!/backend/*ensureLogin":"ensureLogin"},initialize:function(){openbiz.MiddleWareRouter.prototype.initialize.call(this)},ensureLogin:function(e){var n=store.get("admin");if(openbiz.admin=n,null==openbiz.admin||_.isUndefined(openbiz.admin))Backbone.history.navigate("#!/user/login",{trigger:!0,replace:!0});else{this.app.viewService.get("system.HeaderView").setUsername("管理员"),e()}},renderLayout:function(e){if(1==this.isRendered)return void e();var n=this;async.mapSeries(["system.HeaderView","system.MenuView"],function(e,i){null==n.app.viewService.get(e)?n.renderView(e,function(){i(null,null)}):i(null,null)},function(i,r){n.isRendered=!0,e()})}})});